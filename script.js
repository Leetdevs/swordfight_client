// v3
const e={joinedInTheLast500ms:!1};let t={},n={};!function(){const e=new Image;e.src="./img/player/player.webp",t.player=e;const n=new Image;n.src="./img/player/player_hit.webp",t.player_hit=n;const o=new Image;o.src="./img/player/hand_left.webp",t.hand_left=o;const l=new Image;l.src="./img/player/hand_right.webp",t.hand_right=l}(),function(){const e=new Image;e.src="./img/inventory/inventory_slot_empty.webp",t.inventory_slot_empty=e;const n=new Image;n.src="./img/inventory/inventory_slot_full.webp",t.inventory_slot_full=n}(),function(){const e=new Image;e.src="./img/helmets/helmet_stone.webp",t.helmet_stone=e;const n=new Image;n.src="./img/helmets/helmet_iron.webp",t.helmet_iron=n;const o=new Image;o.src="./img/helmets/helmet_gold.webp",t.helmet_gold=o;const l=new Image;l.src="./img/helmets/helmet_diamond.webp",t.helmet_diamond=l;const s=new Image;s.src="./img/helmets/helmet_netherite.webp",t.helmet_netherite=s}(),function(){const e=new Image;e.src="./img/swords/sword_stone.webp",t.sword_stone=e;const n=new Image;n.src="./img/swords/sword_iron.webp",t.sword_iron=n;const o=new Image;o.src="./img/swords/sword_gold.webp",t.sword_gold=o;const l=new Image;l.src="./img/swords/sword_diamond.webp",t.sword_diamond=l;const s=new Image;s.src="./img/swords/sword_netherite.webp",t.sword_netherite=s}(),function(){const e=new Image;e.src="./img/hammers/hammer.webp",t.hammer=e}(),function(){const e=new Image;e.src="./img/buildings/spike_highlight_ally.webp",t.spike_highlight_ally=e;const n=new Image;n.src="./img/buildings/spike_highlight_enemy.webp",t.spike_highlight_enemy=n;const o=new Image;o.src="./img/buildings/wall_stone.webp",t.spike_stone=o;const l=new Image;l.src="./img/buildings/wall_iron.webp",t.spike_iron=l;const s=new Image;s.src="./img/buildings/wall_gold.webp",t.spike_gold=s;const r=new Image;r.src="./img/buildings/wall_diamond.webp",t.spike_diamond=r;const i=new Image;i.src="./img/buildings/wall_netherite.webp",t.spike_netherite=i}(),function(){const e=new Image;e.src="./img/logo/point.webp",t.point=e}(),function(){const e=new Image,t=new Image,o=new Image,l=new Image,s=new Image,r=new Image;e.src="./img/decorations/decoration_shadow_dark1.webp",t.src="./img/decorations/decoration_shadow_dark2.webp",o.src="./img/decorations/decoration_shadow_dark3.webp",l.src="./img/decorations/decoration_shadow_light1.webp",s.src="./img/decorations/decoration_shadow_light2.webp",r.src="./img/decorations/decoration_shadow_light3.webp",n.shadow_dark1=e,n.shadow_dark2=t,n.shadow_dark3=o,n.shadow_light1=l,n.shadow_light2=s,n.shadow_light3=r}(),function(){const e=new Image,t=new Image,o=new Image,l=new Image;e.src="./img/decorations/decoration_flower1.webp",t.src="./img/decorations/decoration_flower2.webp",o.src="./img/decorations/decoration_flower3.webp",l.src="./img/decorations/decoration_flower4.webp",n.flower1=e,n.flower2=t,n.flower3=o,n.flower4=l}();const o=2e3;let l,s=null,r=[],i=null,a=[],d=[],c=[],m=0,u=!1,p=null,h=null,g=null,f={MOUSE:{x:0,y:0},ANGLE:{RAD:1.57},POS:{x:null,y:null},LERP:{x:null,y:null,lerpedX:null,lerpedY:null}},w=[],y={lerpedX:null,lerpedY:null,x:null,y:null},I=null,_=!1,E=!1,v=!1,b=!1,k=!1,L="S";const S={SIZE:0};let P,M,x=function(...e){null!==s&&s(...e)},R=function(){return null!==p&&null!==s&&null!==h},B=function(e){if(R())return h.find((t=>t[0]===e))},T=0;const D={handshake:T++,update:T++,name:T++,move:T++,angle:T++,hit:T++,build:T++,chat:T++,equip:T++,buy:T++,sell:T++,swapItem:T++};let O=0;const A={hands:O++,hammer:O++,spike_stone:O++,spike_iron:O++,spike_gold:O++,spike_diamond:O++,spike_netherite:O++,sword_stone:O++,sword_iron:O++,sword_gold:O++,sword_diamond:O++,sword_netherite:O++,helmet_stone:O++,helmet_iron:O++,helmet_gold:O++,helmet_diamond:O++,helmet_netherite:O++,point:O++},X={[A.hands]:0,[A.hammer]:0,[A.spike_stone]:1,[A.spike_iron]:2,[A.spike_gold]:3,[A.spike_diamond]:4,[A.spike_netherite]:5,[A.sword_stone]:1,[A.sword_iron]:5,[A.sword_gold]:15,[A.sword_diamond]:30,[A.sword_netherite]:60,[A.helmet_stone]:1,[A.helmet_iron]:5,[A.helmet_gold]:15,[A.helmet_diamond]:30,[A.helmet_netherite]:60,[A.point]:1};function Y(e){return void 0!==X[e]?X[e]:0}let U;function C(e,t,n){return e*(1-n)+t*n}function N(){return innerWidth+1}function H(){return innerHeight+1}document.addEventListener("DOMContentLoaded",(e=>{document.getElementById("mainMenu").style.display="none",document.addEventListener("contextmenu",(function(e){e.preventDefault()})),document.addEventListener("mousedown",(e=>{"none"!==document.getElementById("popupGuideImg").style.display&&(document.getElementById("mainMenu").style.display="",document.getElementById("popupGuideImg").style.display="none",e.stopImmediatePropagation())})),document.addEventListener("keydown",(e=>{"none"!==document.getElementById("popupGuideImg").style.display&&(document.getElementById("mainMenu").style.display="",document.getElementById("popupGuideImg").style.display="none",e.stopImmediatePropagation())}))})),document.addEventListener("DOMContentLoaded",(e=>{!function(){!function(){for(let e in A)e.includes("sword_")&&document.getElementById("shopSwordsSelect").add(new Option(e.toUpperCase()+" "+Y(A[e])+"P",e)),e.includes("helmet_")&&document.getElementById("shopHelmetsSelect").add(new Option(e.toUpperCase()+" "+Y(A[e])+"P",e)),e.includes("spike_")&&document.getElementById("shopSpikesSelect").add(new Option(e.toUpperCase()+" "+Y(A[e])+"P",e))}();let e=document.getElementById("shopBg");e.style.display="none",document.addEventListener("keydown",(t=>{t.code.includes("Shift")&&R()&&("block"!==e.style.display&&!1===_?e.style.display="block":e.style.display="none")})),U=function(){return"none"!==document.getElementById("shopBg").style.display},document.getElementById("shopExitCross").addEventListener("mousedown",(t=>{e.style.display="none",t.stopImmediatePropagation()}));var t=document.getElementById("shopSlider"),n=document.getElementById("numberOfItemsText");function o(e){const t=document.getElementById(e).value;for(let e in A)if(e===t)return A[e];return 0}n.innerHTML=`NUMBER OF ITEMS ${t.value}/10`,t.oninput=function(){n.innerHTML=`NUMBER OF ITEMS ${this.value}/10`},document.getElementById("sellHelmets").addEventListener("mousedown",(e=>{const t=o("shopHelmetsSelect");x([D.sell,t,Number(document.getElementById("shopSlider").value)]),e.stopImmediatePropagation()})),document.getElementById("sellSwords").addEventListener("mousedown",(e=>{const t=o("shopSwordsSelect");x([D.sell,t,Number(document.getElementById("shopSlider").value)]),e.stopImmediatePropagation()})),document.getElementById("sellSpikes").addEventListener("mousedown",(e=>{const t=o("shopSpikesSelect");x([D.sell,t,Number(document.getElementById("shopSlider").value)]),e.stopImmediatePropagation()})),document.getElementById("buyHelmets").addEventListener("mousedown",(e=>{const t=o("shopHelmetsSelect");x([D.buy,t,Number(document.getElementById("shopSlider").value)]),e.stopImmediatePropagation()})),document.getElementById("buySwords").addEventListener("mousedown",(e=>{const t=o("shopSwordsSelect");x([D.buy,t,Number(document.getElementById("shopSlider").value)]),e.stopImmediatePropagation()})),document.getElementById("buySpikes").addEventListener("mousedown",(e=>{const t=o("shopSpikesSelect");x([D.buy,t,Number(document.getElementById("shopSlider").value)]),e.stopImmediatePropagation()}))}()}));let $=100,q=.045,G=.025,W=.08,K=0;function Z(e,t,n,o,s){l.beginPath(),l.moveTo(e+s,t),l.arcTo(e+n,t,e+n,t+o,s),l.arcTo(e+n,t+o,e,t+o,s),l.arcTo(e,t+o,e,t,s),l.arcTo(e,t,e+n,t,s),l.closePath(),l.fill()}function F(e){if("string"==typeof e){l.save(),l.translate(0,-91),l.font="bold 18px Montserrat";const t=l.measureText(e);l.fillStyle="rgba(0, 0, 0, 0.5)";const n=6;Z(-t.width/2-n,-20,t.width+2*n,28,5),l.fillStyle="white",l.fillText(e,-t.width/2,0),l.restore()}}function j(e,n){function o(){if(0!==n)for(let e in A)if(n===A[e]){l.drawImage(t[e],-65,-65,130,130);break}}let s=!1;for(let n of c)if(n[0]===e){const e=performance.now()-n[1];if(e>=0&&e<=500){s=!0;const n=1-e/500;l.save(),l.drawImage(t.player,-65,-65,130,130);let r=n;r>.8&&(r=.8),l.save(),l.globalAlpha=r,l.drawImage(t.player_hit,-65,-65,130,130),l.restore(),o(),l.restore();break}}s||(l.drawImage(t.player,-65,-65,130,130),o())}setInterval((function(){$=2*K>=20?2*K:100;let e={camera:144/(t=$)*.025,player:144/t*.045,angle:144/t*.08};var t;G=e.camera,q=e.player,W=e.angle,K=0}),500);const J=function(){const e=Date.now();return function(){const t=(Date.now()-e)%750/750*2*Math.PI;return 11.5+3.5*Math.sin(t)}}();function z(){const e=performance.now()-m;return e>=0&&e<=100?e:0}function Q(e,n){!function(){l.save(),l.translate(0,J());const e=n-z()/50,o=Math.PI/4,s=e/10;if(s>0){let t;t=e<5?o*s:o-o*s,l.rotate(-t)}l.save(),l.translate(48,0),l.drawImage(t.hand_left,-64,-64,128,128),l.restore(),l.restore()}(),function(){l.save(),l.translate(0,J());const o=n-z()/50,s=Math.PI/2,r=o/10;if(r>0){let e;e=o<5?s*r:s-s*r,l.rotate(-e)}l.save(),l.translate(-48,0),function(){for(let n in A)if(e===A[n]&&"hands"!==n){const o=t[n];let s=75,r=-1.5,i=38.5;e===A.hammer&&(s=88,r=-2,i=22),l.save(),l.translate(r,i),l.rotate(Math.PI),l.drawImage(o,-s,-s,2*s,2*s),l.restore()}}(),l.drawImage(t.hand_right,-64,-64,128,128),l.restore(),l.restore()}()}function V(e,t,n){let o,s=!1;if(0!==n){const e=n;s=!0,o=`protection <${(Math.round(e/20*10)/10).toFixed(1)}s>`}else o=t.length>0?`${t}#${e}`:`unnamed#${e}`;l.save(),l.fillStyle=s?"yellow":"white",l.font="bold 18px Montserrat";let r=0-l.measureText(o).width/2;l.fillText(o,r,-65),l.restore()}function ee(e,t,n,o,s){s=Math.min(s,n/2,o/2),l.save(),l.beginPath(),l.moveTo(e+s,t),l.lineTo(e+n-s,t),l.quadraticCurveTo(e+n,t,e+n,t+s),l.lineTo(e+n,t+o-s),l.quadraticCurveTo(e+n,t+o,e+n-s,t+o),l.lineTo(e+s,t+o),l.quadraticCurveTo(e,t+o,e,t+o-s),l.lineTo(e,t+s),l.quadraticCurveTo(e,t,e+s,t),l.closePath(),l.fill(),l.restore()}function te(e){const t=e/200*90;t>0&&(l.save(),l.fillStyle="black",ee(-49,61,98,14,20),l.fillStyle=function(e,t){t<0&&(t=0),t>200&&(t=200);const n=t/200;return`rgb(${Math.round(255*(1-n))}, ${Math.round(255*n)}, 0)`}(0,e),ee(-45,65,t,6,20),l.restore())}function ne(){if(K++,void 0!==l&&null!==p&&null!==h&&null!==g&&null!==s&&null!==f.POS.x&&null!==f.POS.y){const e=h;let i=function(t){return e.find((e=>e[0]===t))};for(let b=d.length-1;b>=0;b--)performance.now()-d[b][3]>250&&d.splice(b,1);for(let k=c.length-1;k>=0;k--)performance.now()-c[k][1]>500&&c.splice(k,1);const m=document.getElementById("canvas");function u(){for(let n of e)if(n[0]===p){for(let e of n[7])for(let n in A)if(e[3]===A[n]){let o,s;l.save();let r=!1;for(let t of d)if(t[0]===e[0]&&t[1]===e[1]){o=t[3],s=t[2],r=!0;break}if(r){const t=performance.now()-o;let n,r;if(t>=0&&t<=250){if(t<=125){const o=t/125;n=e[0]+4*Math.cos(s)*o,r=e[1]+4*Math.sin(s)*o}if(t>125){const o=t/125-1;n=e[0]+(4*Math.cos(s)-4*Math.cos(s)*o),r=e[1]+(4*Math.sin(s)-4*Math.sin(s)*o)}}void 0!==n&&void 0!==r?l.translate(n,r):l.translate(e[0],e[1])}else l.translate(e[0],e[1]);l.rotate(e[2]),l.drawImage(t.spike_highlight_ally,-68,-68,136,136),l.drawImage(t[n],-69,-69,138,138),l.restore()}}else for(let e of n[7])for(let n in A)if(e[3]===A[n]){let o,s;l.save();let r=!1;for(let t of d)if(t[0]===e[0]&&t[1]===e[1]){o=t[3],s=t[2],r=!0;break}if(r){const t=performance.now()-o;let n,r;if(t>=0&&t<=250){if(t<=125){const o=t/125;n=e[0]+4*Math.cos(s)*o,r=e[1]+4*Math.sin(s)*o}if(t>125){const o=t/125-1;n=e[0]+(4*Math.cos(s)-4*Math.cos(s)*o),r=e[1]+(4*Math.sin(s)-4*Math.sin(s)*o)}}void 0!==n&&void 0!==r?l.translate(n,r):l.translate(e[0],e[1])}else l.translate(e[0],e[1]);l.rotate(e[2]),l.drawImage(t.spike_highlight_enemy,-68,-68,136,136),l.drawImage(t[n],-69,-69,138,138),l.restore()}}function I(){for(let o of e)if(o[0]!==p){let e,s,r;const i=o[0],a=o[1],d=o[2][0],c=o[2][1],m=o[3];let u=!1;for(let t of w)if(t[0]===i){u=!0,e=t[1],s=t[2],r=t[3];break}u||(e=d,s=c,r=m,w.push([i,d,c,m]));const p=C(e,d,q),h=C(s,c,q),g=(n=W,(t=r)+function(e,t){var n=2*Math.PI,o=(t-e)%n;return 2*o%n-o}(t,m)*n);for(let e of w)if(e[0]===i){e[1]=p,e[2]=h,e[3]=g;break}l.save(),l.translate(p,h),l.save(),l.rotate(g-Math.PI/2),Q(o[5],o[9]),j(o[0],o[6]),l.restore(),V(i,a,o[11]),F(o[10]),te(o[8]),l.restore()}var t,n}function _(){f.LERP.x=f.POS.x,f.LERP.y=f.POS.y,null!==f.LERP.lerpedX&&null!==f.LERP.lerpedY||(f.LERP.lerpedX=f.LERP.x,f.LERP.lerpedY=f.LERP.y),f.LERP.lerpedX=C(f.LERP.lerpedX,f.LERP.x,q),f.LERP.lerpedY=C(f.LERP.lerpedY,f.LERP.y,q),f.LERP.x=f.LERP.lerpedX,f.LERP.y=f.LERP.lerpedY,l.save(),l.translate(f.LERP.lerpedX,f.LERP.lerpedY);let e=f.ANGLE.RAD;l.save(),l.rotate(e-Math.PI/2);const t=i(p);Q(t[5],t[10]),j(t[0],t[6]),l.restore(),V(t[0],t[1],t[13]),F(t[12]),te(t[9]),l.restore()}function E(){function e(e,n,o,s){l.save();for(let r in A){const i=t[r];if(n[o][0]===A[r]&&i){let a=1,d=0,c=0;r.includes("spike")?(a=.9,d=.052*e):r.includes("sword")?(a=1.45,c=Math.PI/4,d=.07*e):r.includes("helmet")?(a=1.5,d=.25*e):"point"===r?(a=.82,d=.052*e):"hammer"===r&&(a=1.55,c=Math.PI/4,d=.09*e),l.save(),0!==c&&l.rotate(c),l.translate(0,d),r.includes("spike")&&l.drawImage(t.spike_highlight_ally,-e*a,-e*a,e*a*2,e*a*2),l.drawImage(i,-e*a,-e*a,e*a*2,e*a*2),l.restore(),l.save(),l.fillStyle="white",l.font=`bold ${s}px Montserrat`;let m="x"+String(n[o][1]),u=l.measureText(m).width;l.fillText(m,.92*e-u,.92*e),l.restore();break}}l.restore()}const n=i(p)[8],o=Math.round(.2*innerWidth),s=Math.round(o/10),r=Math.round(o/10.6),d=Math.round(o/25),c=Math.round(.7*s),m=Math.round(.45*s),u=Math.round(.8*s),h=Math.round(innerWidth/2),g=Math.round(5*s+4*r+r/2);let f;const w=[];for(let o=0;o<10;o++){const i=o+1;if(i<=5){const a=h-g,p=s+r,y=a+o*p;l.save(),l.translate(y,innerHeight-s),w.push([y,innerHeight-s,u]),f=a+(o+1)*p,null===n[o]?l.drawImage(t.inventory_slot_empty,-s,-s,2*s,2*s):(l.drawImage(t.inventory_slot_full,-s,-s,2*s,2*s),e(u,n,o,d),l.save(),l.fillStyle="white",l.font=`bold ${d}px Montserrat`,l.fillText(String(i),-c,-m),l.restore()),l.restore()}else{const a=f+(o-5)*(s+r);l.save(),l.translate(a,innerHeight-s),w.push([a,innerHeight-s,u]),null===n[o]?l.drawImage(t.inventory_slot_empty,-s,-s,2*s,2*s):(l.drawImage(t.inventory_slot_full,-s,-s,2*s,2*s),e(u,n,o,d),l.save(),l.fillStyle="white",l.font=`bold ${d}px Montserrat`,l.fillText(String(i),-c,-m),l.restore()),l.restore()}}a=structuredClone(w)}function v(){S.SIZE=Math.round(.18*(innerHeight<=innerWidth?innerHeight:innerWidth)),P.width=S.SIZE,P.height=S.SIZE,P.style.bottom=.04*S.SIZE+"px",P.style.right=.04*S.SIZE+"px";const e=S.SIZE/o,t=f.LERP.lerpedX*e,n=f.LERP.lerpedY*e;M.clearRect(0,0,P.width,P.height),M.fillStyle="rgba(0, 0, 0, 0.4)",M.fillRect(0,0,P.width,P.height),function(){const e=.027*S.SIZE;M.save(),M.beginPath(),M.arc(t,n,e,0,2*Math.PI),M.fillStyle="white",M.fill(),M.closePath(),M.restore()}()}m.width=N(),m.height=H(),y.x=m.width/2-f.POS.x,y.y=m.height/2-f.POS.y,null!==y.lerpedX&&null!==y.lerpedY||(y.lerpedX=y.x,y.lerpedY=y.y),y.lerpedX=C(y.lerpedX,y.x,G),y.lerpedY=C(y.lerpedY,y.y,G),y.x=y.lerpedX,y.y=y.lerpedY,l.clearRect(0,0,N(),H()),l.save(),l.fillStyle="#242424",l.fillRect(0,0,N(),H()),l.restore(),l.save(),l.translate(y.lerpedX,y.lerpedY),l.save(),l.fillStyle="#133a2b",l.fillRect(0,0,o,o),l.restore(),function(){const e=[[102,1027,1],[87,1305,0],[80,1680,1],[172,390,0],[218,1101,0],[316,120,2],[279,396,3],[328,1296,1],[328,1393,3],[314,1825,1],[426,97,0],[391,1025,0],[418,1691,0],[508,1116,1],[491,1603,1],[473,1721,1],[477,1903,0],[622,105,0],[594,271,3],[579,381,0],[587,472,2],[601,694,1],[610,1270,1],[720,218,2],[697,671,3],[696,1825,1],[818,702,3],[818,808,1],[779,1170,0],[887,1712,0],[972,179,0],[1002,307,1],[1090,211,3],[1099,1191,3],[1116,1278,1],[1225,97,0],[1196,1616,3],[1321,713,3],[1282,805,2],[1294,1426,2],[1406,90,1],[1392,1026,3],[1527,506,2],[1474,699,3],[1495,798,0],[1690,695,2],[1682,820,1],[1728,1530,1],[1778,821,2],[1779,1881,2],[1877,775,1],[1892,1798,2],[91,413,8],[78,824,7],[85,918,7],[104,1925,6],[219,191,7],[188,810,9],[204,970,7],[213,1222,8],[306,787,4],[291,1225,4],[423,316,8],[394,426,7],[373,590,6],[429,688,8],[413,795,9],[515,113,6],[522,1817,4],[607,228,4],[594,770,7],[672,381,6],[708,807,8],[804,1509,6],[915,487,4],[897,792,6],[888,1128,9],[871,1197,9],[916,1380,9],[876,1499,9],[983,1018,6],[973,1097,9],[976,1223,8],[1004,1790,5],[1099,377,6],[1086,875,5],[1079,1521,5],[1110,1718,9],[1081,1918,7],[1221,214,6],[1212,587,5],[1177,720,9],[1185,1325,7],[1176,1879,4],[1314,280,5],[1330,924,4],[1279,981,6],[1428,715,8],[1420,1370,4],[1389,1774,5],[1477,1377,6],[1526,1913,8],[1607,783,7],[1614,1085,5],[1613,1383,8],[1708,1021,6],[1772,707,4],[1788,1325,6],[1830,1526,7],[1917,89,4],[1902,701,5],[1890,1680,6]];function t(e){let t=0;for(let o in n){if(e===t)return o;t++}}for(let o of e){l.save(),l.translate(o[0],o[1]);const e=t(o[2]),s=n[e];let r;e.includes("flower")?r=20:e.includes("shadow")&&(r=40),l.drawImage(s,-r,-r,2*r,2*r),l.restore()}}(),u(),I(),_(),l.restore(),E(),v(),function(){const e=innerWidth-222.70775;l.save(),l.translate(e,7.70775),l.fillStyle="rgba(0, 0, 0, 0.4)",Z(0,0,215,255,10.75),l.font="bold 23.65px Montserrat",l.fillStyle="white";let t="Leaderboard",n=107.5-l.measureText(t).width/2;l.fillText(t,n,26.015),function(){l.font="bold 16.125px Montserrat",l.fillStyle="rgba(255, 255, 255, 0.9)";const e=42.097;let t=0;for(let n of r){t++;let o=`${t}.`;l.fillText(o,10.75,e+18.54375*t);let s=`${n[0]}`,r=l.measureText(s).width;l.fillText(s,107.5-r/2,e+18.54375*t);let i=`${n[1]}`,a=l.measureText(i).width;l.fillText(i,215-(10.75+a),e+18.54375*t)}}(),l.restore()}()}requestAnimationFrame(ne)}document.addEventListener("DOMContentLoaded",(()=>{l=canvas.getContext("2d"),P=document.getElementById("minimapCanvas"),M=P.getContext("2d"),document.getElementById("canvas").style.display="none",document.getElementById("minimapCanvas").style.display="none",document.getElementById("chatInput").style.display="none",document.getElementById("playButton").addEventListener("mousedown",(()=>{!function(){if(!u&&!e.joinedInTheLast500ms){let t;e.joinedInTheLast500ms=!0,setTimeout((()=>{e.joinedInTheLast500ms=!1}),500),t=new WebSocket("wss://europe.swordfight.io"),t.addEventListener("open",(()=>{u=!0,document.getElementById("menu").style.display="none",document.getElementById("canvas").style.display="",document.getElementById("minimapCanvas").style.display="",s=function(e){t.send(JSON.stringify(e))},x([D.name,document.getElementById("nameInput").value])})),t.addEventListener("message",(e=>{const t=JSON.parse(e.data);switch(t[0]){case D.handshake:p=t[1];break;case D.update:{m=performance.now(),null!==h&&(g=h),h=t[1];const e=t[2];for(let t of e){const e=performance.now();if(1===t.length){let n=!1;for(let o of c)o[0]===t[0]&&(o[1]=e,n=!0);n||c.push([t[0],e])}if(3===t.length){let n=!1;for(let o of d)o[0]===t[0]&&o[1]===t[1]&&(o[2]=t[2],o[3]=e,n=!0);n||d.push([t[0],t[1],t[2],e])}}for(let e of h){const t=e[0];if(p===t){const t=e[2][0],n=e[2][1];f.POS.x=t,f.POS.y=n;break}}break}case"l":r=t[1]}})),t.addEventListener("close",(()=>{s=null,r=[],i=null,a=[],d=[],c=[],m=0,u=!1,p=null,h=null,g=null,f={MOUSE:{x:0,y:0},ANGLE:{RAD:1.57},POS:{x:null,y:null},LERP:{x:null,y:null,lerpedX:null,lerpedY:null}},w=[],y={lerpedX:null,lerpedY:null,x:null,y:null},I=null,_=!1,E=!1,v=!1,b=!1,k=!1,L="S",l.clearRect(0,0,N(),H()),document.getElementById("menu").style.display="",document.getElementById("canvas").style.display="none",document.getElementById("minimapCanvas").style.display="none",document.getElementById("chatInput").style.display="none",document.getElementById("shopBg").style.display="none"}))}}()})),ne(),function(){function e(e){let t=0;switch(e){case"U":t=1;break;case"D":t=2;break;case"L":t=3;break;case"R":t=4;break;case"UL":t=5;break;case"UR":t=6;break;case"DL":t=7;break;case"DR":t=8}return t}function t(){let e="";return!0===E&&!1===v&&(e+="U"),!0===v&&!1===E&&(e+="D"),!0===b&&!1===k&&(e+="L"),!0===k&&!1===b&&(e+="R"),e.includes("U")&&e.includes("L")&&(e="UL"),e.includes("U")&&e.includes("R")&&(e="UR"),e.includes("D")&&e.includes("L")&&(e="DL"),e.includes("D")&&e.includes("R")&&(e="DR"),""===e&&(e="S"),e}document.addEventListener("keydown",(n=>{if(R()&&!1===_){switch(n.code){case"ArrowUp":case"KeyW":E=!0;break;case"ArrowDown":case"KeyS":v=!0;break;case"ArrowLeft":case"KeyA":b=!0;break;case"ArrowRight":case"KeyD":k=!0}let o=t();o!==L&&(L=o,x([D.move,e(L)]))}})),document.addEventListener("keyup",(n=>{if(R()&&!1===_){switch(n.code){case"ArrowUp":case"KeyW":E=!1;break;case"ArrowDown":case"KeyS":v=!1;break;case"ArrowLeft":case"KeyA":b=!1;break;case"ArrowRight":case"KeyD":k=!1}let o=t();o!==L&&(L=o,x([D.move,e(L)]))}}))}(),document.addEventListener("mousemove",(e=>{const t=B(p);if(R()&&void 0!==t&&null!==f.LERP.lerpedX&&null!==f.LERP.lerpedY&&null!==y.lerpedX&&null!==y.lerpedY){f.MOUSE.x=e.x,f.MOUSE.y=e.y;let t=f.LERP.lerpedX+y.lerpedX,n=f.LERP.lerpedY+y.lerpedY;f.ANGLE.RAD=Math.atan2(f.MOUSE.y-n,f.MOUSE.x-t)}})),setInterval((()=>{if(R()&&null!==f.LERP.lerpedX&&null!==f.LERP.lerpedY&&null!==y.lerpedX&&null!==y.lerpedY){let e=Math.round(100*f.ANGLE.RAD)/100;e<-3.14&&(e=-3.14),e>3.14&&(e=3.14),I!==e&&x([D.angle,e]),I=e}}),100),document.addEventListener("keydown",(e=>{if(R()&&!1===_&&!1===U()){const t=B(p);let n=0;switch(e.code){case"Digit1":n=1;break;case"Digit2":n=2;break;case"Digit3":n=3;break;case"Digit4":n=4;break;case"Digit5":n=5;break;case"Digit6":n=6;break;case"Digit7":n=7;break;case"Digit8":n=8;break;case"Digit9":n=9;break;case"Digit0":n=10}if(0!==n){const e=t[8];null!==e[n-1]&&x([D.equip,e[n-1][0]])}}})),function(){let e=!1,n=0,o=0;function s(e,t,n,o){return Math.sqrt(Math.pow(n-e,2)+Math.pow(o-t,2))}let r=0;document.addEventListener("mousedown",(t=>{if(!e){e=!0;let n=0,o=!1;for(let l of a)if(n++,s(l[0],l[1],t.x,t.y)<=1.2*l[2]){function d(){if(R()&&!e&&performance.now()-r>100){const e=B(p)[8][n-1];null!==e&&x([D.equip,e[0]]),o=!1,i=null}}t.stopImmediatePropagation(),i=[structuredClone(n),structuredClone(l)],o=!0,setTimeout(d,100);break}o||(i=null)}})),document.addEventListener("mouseup",(t=>{if(e){if(null!==i){let e=0;for(let n of a)e++,i[0]!==e&&s(n[0],n[1],t.x,t.y)<=1.2*n[2]&&(r=performance.now(),x([D.swapItem,i[0],e]))}e=!1,i=null}})),document.addEventListener("mousemove",(e=>{n=e.x,o=e.y})),function s(){if(R()&&e&&null!==i){const e=i[1][2],s=B(p)[8][i[0]-1];if(null!==s)for(let r in A)if(0!==A[r]&&A[r]===s[0]){let s=1,i=0,a=0;r.includes("spike")?(s=.9,i=.052*e):r.includes("sword")?(s=1.45,a=Math.PI/4,i=.07*e):r.includes("helmet")?(s=1.5,i=.25*e):"point"===r?(s=.82,i=.052*e):"hammer"===r&&(s=1.55,a=Math.PI/4,i=.09*e),l.save(),l.translate(n,o),0!==a&&l.rotate(a),r.includes("spike")&&l.drawImage(t.spike_highlight_ally,-e*s,-e*s,e*s*2,e*s*2),l.drawImage(t[r],-e*s,-e*s,e*s*2,e*s*2),l.restore()}}requestAnimationFrame(s)}()}(),document.addEventListener("mousedown",(()=>{R()&&!1===U()&&x([D.hit,1])})),document.addEventListener("mouseup",(()=>{R()&&x([D.hit,0])})),document.addEventListener("keydown",(e=>{if(R()&&"Enter"===e.code&&!1===U()){_=!_;const e=document.getElementById("chatInput");_&&e&&(e.style.display="",e.value="",e.focus()),!_&&e&&(e.value.length>0&&x([D.chat,e.value]),e.style.display="none","S"!==L&&x([D.move,0]),E=!1,v=!1,b=!1,k=!1,L="S")}})),function(){function e(){if(R()&&!1===_&&!1===U()){let e=B(p),t=e[8],n=e[11];const o=[A.spike_netherite,A.spike_diamond,A.spike_gold,A.spike_iron,A.spike_stone];let l=Math.round(100*f.ANGLE.RAD)/100;l<-3.14&&(l=-3.14),l>3.14&&(l=3.14);for(let e of o){const o=[];for(let e=0;e<t.length;e++)null!==t[e]&&o.push(t[e][0]);if(o.includes(e))return void(0===n&&(x([D.angle,l]),x([D.build,e])))}}}let t,n=!1;document.addEventListener("keydown",(o=>{"Space"===o.code&&R()&&!n&&(e(),t=setInterval(e,100),n=!0)})),document.addEventListener("keyup",(e=>{"Space"===e.code&&(clearInterval(t),n=!1)}))}()}));
